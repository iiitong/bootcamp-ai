# Project Alpha - Ticket 管理工具需求和设计文档

**文档版本**: v1.2
**创建日期**: 2025-12-04
**最后更新**: 2025-12-04
**项目代号**: Project Alpha

---

## 1. 项目概述

### 1.1 项目背景
Project Alpha 是一个轻量级的 Ticket 管理工具，旨在提供简单高效的任务跟踪和分类功能。系统采用现代化技术栈，无需复杂的用户认证系统，专注于核心的任务管理功能。

### 1.2 项目目标
- 提供直观的 Ticket 创建和管理界面
- 支持基于标签的灵活分类系统
- 实现快速的搜索和过滤功能
- 保证良好的用户体验和响应速度

### 1.3 技术栈
- **数据库**: PostgreSQL
- **后端**: FastAPI (Python)
- **前端**: TypeScript + Vite + Tailwind CSS + Shadcn UI
- **通信协议**: RESTful API

---

## 2. 功能需求

### 2.1 Ticket 管理

#### 2.1.1 创建 Ticket
- 用户可以创建新的 Ticket
- 必填字段：
  - 标题 (title)：字符串，最大长度 200 字符
- 可选字段：
  - 描述 (description)：文本，支持多行
  - 标签 (tags)：可以在创建时添加多个标签
- 系统自动字段：
  - 创建时间 (created_at)
  - 更新时间 (updated_at)
  - 状态 (status)：默认为"未完成"
  - 唯一标识 (id)

#### 2.1.2 编辑 Ticket
- 用户可以编辑已存在的 Ticket
- 可编辑字段：
  - 标题
  - 描述
- 编辑后自动更新 updated_at 时间戳

#### 2.1.3 删除 Ticket
- 用户可以删除任何 Ticket
- 删除操作需要二次确认
- 删除是永久性操作，无回收站功能

#### 2.1.4 完成/取消完成 Ticket
- 用户可以标记 Ticket 为"已完成"状态
- 用户可以将"已完成"的 Ticket 恢复为"未完成"状态
- 状态变更会更新 updated_at 时间戳
- 已完成的 Ticket 在列表中有视觉区分（如删除线、不同颜色）

### 2.2 标签管理

#### 2.2.1 添加标签到 Ticket
- 用户可以为 Ticket 添加一个或多个标签
- 标签名称：
  - 字符串类型，最大长度 50 字符
  - 不区分大小写（自动转换为小写）
  - 自动去除首尾空格
- 如果标签不存在，系统自动创建
- 一个 Ticket 可以有多个标签
- 同一标签不能重复添加到同一 Ticket

#### 2.2.2 从 Ticket 移除标签
- 用户可以从 Ticket 中移除任何已关联的标签
- 移除标签不会删除标签本身（标签可能被其他 Ticket 使用）
- 如果某个标签不再被任何 Ticket 使用，系统保留该标签（可选：定期清理未使用标签）

#### 2.2.3 标签显示
- 标签以彩色徽章形式显示
- 系统为每个标签分配一个颜色（基于标签名称的哈希值）
- 标签按字母顺序排列

### 2.3 查询和过滤功能

#### 2.3.1 标签过滤
- 用户可以选择一个或多个标签进行过滤
- 多标签过滤逻辑：
  - 默认为 AND 逻辑（显示同时包含所有选中标签的 Ticket）
  - 可选：支持切换为 OR 逻辑（显示包含任一选中标签的 Ticket）
- 过滤结果实时更新
- 显示当前过滤条件和结果数量

#### 2.3.2 标题搜索
- 用户可以输入关键词搜索 Ticket 标题
- 搜索特性：
  - 不区分大小写
  - 支持部分匹配（包含关键词即可）
  - 实时搜索（输入时即时更新结果）
  - 可选：支持描述字段搜索
- 搜索可以与标签过滤组合使用

#### 2.3.3 状态过滤
- 用户可以选择查看：
  - 所有 Ticket
  - 仅未完成的 Ticket
  - 仅已完成的 Ticket
- 默认显示所有 Ticket

#### 2.3.4 排序
- 支持按以下字段排序：
  - 创建时间（默认：最新在前）
  - 更新时间
  - 标题（字母顺序）
- 支持升序/降序切换

### 2.4 列表展示

#### 2.4.1 Ticket 列表视图
- 以卡片或列表形式展示 Ticket
- 每个 Ticket 显示：
  - 标题
  - 状态标识
  - 关联的标签
  - 创建时间
  - 更新时间
- 支持分页或无限滚动加载

#### 2.4.2 标签云/标签列表
- 侧边栏或顶部显示所有可用标签
- 显示每个标签关联的 Ticket 数量
- 点击标签进行过滤

---

## 3. 技术架构设计

### 3.1 系统架构图

```
┌─────────────────────────────────────────────────┐
│                   Frontend                      │
│  (TypeScript + Vite + Tailwind + Shadcn)       │
│                                                 │
│  ┌─────────────┐  ┌──────────────┐            │
│  │   Ticket    │  │    Tag       │            │
│  │ Management  │  │  Management  │            │
│  └─────────────┘  └──────────────┘            │
│                                                 │
│  ┌─────────────┐  ┌──────────────┐            │
│  │   Search    │  │   Filter     │            │
│  │  Component  │  │  Component   │            │
│  └─────────────┘  └──────────────┘            │
└─────────────────────────────────────────────────┘
                      │ HTTP/REST
                      ▼
┌─────────────────────────────────────────────────┐
│                Backend (FastAPI)                │
│                                                 │
│  ┌─────────────┐  ┌──────────────┐            │
│  │   Ticket    │  │     Tag      │            │
│  │   Router    │  │    Router    │            │
│  └─────────────┘  └──────────────┘            │
│                                                 │
│  ┌─────────────┐  ┌──────────────┐            │
│  │   Ticket    │  │     Tag      │            │
│  │   Service   │  │   Service    │            │
│  └─────────────┘  └──────────────┘            │
│                                                 │
│  ┌──────────────────────────────────┐          │
│  │       Database Models            │          │
│  └──────────────────────────────────┘          │
└─────────────────────────────────────────────────┘
                      │ SQL
                      ▼
┌─────────────────────────────────────────────────┐
│             PostgreSQL Database                 │
│                                                 │
│  ┌─────────┐  ┌──────┐  ┌───────────────┐    │
│  │ tickets │  │ tags │  │ ticket_tags   │    │
│  └─────────┘  └──────┘  └───────────────┘    │
└─────────────────────────────────────────────────┘
```

### 3.2 技术选型说明

#### 3.2.1 后端 - FastAPI
- **优势**：
  - 现代化 Python Web 框架
  - 自动生成 OpenAPI 文档
  - 原生支持异步操作
  - 优秀的性能表现
  - 内置数据验证（Pydantic）

#### 3.2.2 数据库 - PostgreSQL
- **优势**：
  - 强大的关系型数据库
  - 优秀的 JSON 支持（可选功能扩展）
  - 支持全文搜索
  - 事务安全
  - 丰富的数据类型

#### 3.2.3 前端 - TypeScript + Vite + Tailwind + Shadcn
- **TypeScript**：类型安全，减少运行时错误
- **Vite**：快速的开发服务器和构建工具
- **Tailwind CSS**：实用优先的 CSS 框架，快速开发
- **Shadcn UI**：高质量的 React 组件库，基于 Radix UI

---

## 4. 数据库设计

### 4.1 表结构设计

#### 4.1.1 tickets 表
存储 Ticket 的主要信息。

```sql
CREATE TABLE tickets (
    id BIGSERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

-- 索引
CREATE INDEX idx_tickets_status ON tickets(status);
CREATE INDEX idx_tickets_created_at ON tickets(created_at DESC);
CREATE INDEX idx_tickets_updated_at ON tickets(updated_at DESC);
CREATE INDEX idx_tickets_title ON tickets(title);
```

**字段说明**：
- `id`: 主键，自增整数
- `title`: Ticket 标题，最大 200 字符，非空
- `description`: Ticket 描述，可选
- `status`: 状态，可选值：'pending'（未完成）、'completed'（已完成）
- `created_at`: 创建时间，自动设置
- `updated_at`: 更新时间，自动更新

#### 4.1.2 tags 表
存储所有标签信息。

```sql
CREATE TABLE tags (
    id BIGSERIAL PRIMARY KEY,
    name VARCHAR(50) NOT NULL UNIQUE,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

-- 索引
CREATE UNIQUE INDEX idx_tags_name ON tags(name);
```

**字段说明**：
- `id`: 主键，自增整数
- `name`: 标签名称，最大 50 字符，唯一，非空
- `created_at`: 创建时间

#### 4.1.3 ticket_tags 表（关联表）
存储 Ticket 和 Tag 的多对多关系。

```sql
CREATE TABLE ticket_tags (
    ticket_id BIGINT NOT NULL,
    tag_id BIGINT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    PRIMARY KEY (ticket_id, tag_id),
    FOREIGN KEY (ticket_id) REFERENCES tickets(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE
);

-- 索引
CREATE INDEX idx_ticket_tags_ticket_id ON ticket_tags(ticket_id);
CREATE INDEX idx_ticket_tags_tag_id ON ticket_tags(tag_id);
```

**字段说明**：
- `ticket_id`: Ticket ID（外键，BIGINT 类型匹配 tickets 表主键）
- `tag_id`: Tag ID（外键，BIGINT 类型匹配 tags 表主键）
- `created_at`: 关联创建时间
- 复合主键：(ticket_id, tag_id)
- 级联删除：删除 Ticket 或 Tag 时自动删除关联关系

### 4.2 数据库关系图

```
┌─────────────────────┐
│      tickets        │
├─────────────────────┤
│ id (PK)            │
│ title              │
│ description        │
│ status             │
│ created_at         │
│ updated_at         │
└──────────┬──────────┘
           │
           │ 1:N
           │
┌──────────▼──────────┐
│   ticket_tags       │
├─────────────────────┤
│ ticket_id (PK, FK) │
│ tag_id (PK, FK)    │
│ created_at         │
└──────────┬──────────┘
           │
           │ N:1
           │
┌──────────▼──────────┐
│       tags          │
├─────────────────────┤
│ id (PK)            │
│ name (UNIQUE)      │
│ created_at         │
└─────────────────────┘
```

### 4.3 数据库触发器（自动更新 updated_at）

```sql
-- 创建触发器函数
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- 应用到 tickets 表
CREATE TRIGGER update_tickets_updated_at
BEFORE UPDATE ON tickets
FOR EACH ROW
EXECUTE FUNCTION update_updated_at_column();
```

---

## 5. API 设计

### 5.1 API 基础信息

- **Base URL**: `http://localhost:8000/api/v1`
- **数据格式**: JSON
- **HTTP 方法**: GET, POST, PUT, PATCH, DELETE

### 5.2 Ticket API Endpoints

#### 5.2.1 获取所有 Tickets
```
GET /tickets
```

**Query Parameters**:
- `status` (optional): 过滤状态 - 'pending', 'completed', 'all'（默认：'all'）
- `tags` (optional): 标签过滤，逗号分隔的标签 ID - 例如 '1,2,3'
- `tag_filter_mode` (optional): 标签过滤模式 - 'and'（默认）, 'or'
- `search` (optional): 搜索关键词（搜索标题）
- `sort_by` (optional): 排序字段 - 'created_at'（默认）, 'updated_at', 'title'
- `sort_order` (optional): 排序顺序 - 'desc'（默认）, 'asc'
- `page` (optional): 页码（默认：1）
- `page_size` (optional): 每页数量（默认：20）

**Response** (200 OK):
```json
{
  "data": [
    {
      "id": 1,
      "title": "实现用户登录功能",
      "description": "需要实现基本的用户登录功能",
      "status": "pending",
      "tags": [
        {
          "id": 1,
          "name": "feature"
        },
        {
          "id": 2,
          "name": "backend"
        }
      ],
      "created_at": "2025-12-04T10:00:00Z",
      "updated_at": "2025-12-04T10:00:00Z"
    }
  ],
  "total": 1,
  "page": 1,
  "page_size": 20,
  "total_pages": 1
}
```

#### 5.2.2 获取单个 Ticket
```
GET /tickets/{ticket_id}
```

**Response** (200 OK):
```json
{
  "id": 1,
  "title": "实现用户登录功能",
  "description": "需要实现基本的用户登录功能",
  "status": "pending",
  "tags": [
    {
      "id": 1,
      "name": "feature"
    }
  ],
  "created_at": "2025-12-04T10:00:00Z",
  "updated_at": "2025-12-04T10:00:00Z"
}
```

**Error Response** (404 Not Found):
```json
{
  "detail": "Ticket not found"
}
```

#### 5.2.3 创建 Ticket
```
POST /tickets
```

**Request Body**:
```json
{
  "title": "实现用户登录功能",
  "description": "需要实现基本的用户登录功能",
  "tag_ids": [1, 2]  // 可选
}
```

**Response** (201 Created):
```json
{
  "id": 1,
  "title": "实现用户登录功能",
  "description": "需要实现基本的用户登录功能",
  "status": "pending",
  "tags": [
    {
      "id": 1,
      "name": "feature"
    },
    {
      "id": 2,
      "name": "backend"
    }
  ],
  "created_at": "2025-12-04T10:00:00Z",
  "updated_at": "2025-12-04T10:00:00Z"
}
```

**Error Response** (422 Unprocessable Entity):
```json
{
  "detail": [
    {
      "loc": ["body", "title"],
      "msg": "field required",
      "type": "value_error.missing"
    }
  ]
}
```

#### 5.2.4 更新 Ticket
```
PUT /tickets/{ticket_id}
```

**Request Body**:
```json
{
  "title": "更新后的标题",
  "description": "更新后的描述"
}
```

**Response** (200 OK):
```json
{
  "id": 1,
  "title": "更新后的标题",
  "description": "更新后的描述",
  "status": "pending",
  "tags": [],
  "created_at": "2025-12-04T10:00:00Z",
  "updated_at": "2025-12-04T11:00:00Z"
}
```

#### 5.2.5 更新 Ticket 状态
```
PATCH /tickets/{ticket_id}/status
```

**Request Body**:
```json
{
  "status": "completed"  // 或 "pending"
}
```

**Response** (200 OK):
```json
{
  "id": 1,
  "title": "实现用户登录功能",
  "description": "需要实现基本的用户登录功能",
  "status": "completed",
  "tags": [],
  "created_at": "2025-12-04T10:00:00Z",
  "updated_at": "2025-12-04T11:30:00Z"
}
```

#### 5.2.6 删除 Ticket
```
DELETE /tickets/{ticket_id}
```

**Response** (204 No Content)

**Error Response** (404 Not Found):
```json
{
  "detail": "Ticket not found"
}
```

### 5.3 Tag API Endpoints

#### 5.3.1 获取所有 Tags
```
GET /tags
```

**Query Parameters**:
- `include_count` (optional): 是否包含每个标签的 Ticket 数量（默认：true）

**Response** (200 OK):
```json
{
  "data": [
    {
      "id": 1,
      "name": "feature",
      "ticket_count": 5,
      "created_at": "2025-12-04T09:00:00Z"
    },
    {
      "id": 2,
      "name": "bug",
      "ticket_count": 3,
      "created_at": "2025-12-04T09:30:00Z"
    }
  ],
  "total": 2
}
```

#### 5.3.2 创建 Tag
```
POST /tags
```

**Request Body**:
```json
{
  "name": "feature"
}
```

**Response** (201 Created):
```json
{
  "id": 1,
  "name": "feature",
  "created_at": "2025-12-04T09:00:00Z"
}
```

**Error Response** (409 Conflict):
```json
{
  "detail": "Tag already exists"
}
```

#### 5.3.3 删除 Tag
```
DELETE /tags/{tag_id}
```

**Response** (204 No Content)

### 5.4 Ticket-Tag 关联 API Endpoints

#### 5.4.1 为 Ticket 添加 Tag
```
POST /tickets/{ticket_id}/tags
```

**Request Body**:
```json
{
  "tag_id": 1
}
```

或者使用标签名称自动创建：
```json
{
  "tag_name": "urgent"
}
```

**Response** (200 OK):
```json
{
  "id": 1,
  "title": "实现用户登录功能",
  "description": "需要实现基本的用户登录功能",
  "status": "pending",
  "tags": [
    {
      "id": 1,
      "name": "feature"
    },
    {
      "id": 3,
      "name": "urgent"
    }
  ],
  "created_at": "2025-12-04T10:00:00Z",
  "updated_at": "2025-12-04T10:00:00Z"
}
```

#### 5.4.2 从 Ticket 移除 Tag
```
DELETE /tickets/{ticket_id}/tags/{tag_id}
```

**Response** (200 OK):
```json
{
  "id": 1,
  "title": "实现用户登录功能",
  "description": "需要实现基本的用户登录功能",
  "status": "pending",
  "tags": [
    {
      "id": 1,
      "name": "feature"
    }
  ],
  "created_at": "2025-12-04T10:00:00Z",
  "updated_at": "2025-12-04T10:00:00Z"
}
```

### 5.5 错误响应格式

所有错误响应遵循统一格式：

```json
{
  "detail": "错误描述信息"
}
```

HTTP 状态码：
- 200: 成功
- 201: 创建成功
- 204: 删除成功（无内容）
- 400: 请求参数错误
- 404: 资源不存在
- 409: 资源冲突
- 422: 数据验证失败
- 500: 服务器内部错误

---

## 6. 前端设计

### 6.1 页面结构

#### 6.1.1 主页面布局

```
┌─────────────────────────────────────────────────────────┐
│                       Header                            │
│  [Logo] Project Alpha          [搜索框]      [新建]    │
└─────────────────────────────────────────────────────────┘
┌─────────────┬───────────────────────────────────────────┐
│             │                                           │
│  Sidebar    │           Main Content                    │
│             │                                           │
│ 过滤器       │  ┌──────────────────────────────────┐   │
│ ┌─────────┐ │  │        Ticket Card 1             │   │
│ │ 状态    │ │  │  □ Title                         │   │
│ │ □ 全部  │ │  │  [tag1] [tag2]                   │   │
│ │ □ 待办  │ │  │  创建: 2025-12-04               │   │
│ │ □ 完成  │ │  └──────────────────────────────────┘   │
│ └─────────┘ │                                           │
│             │  ┌──────────────────────────────────┐   │
│ 标签        │  │        Ticket Card 2             │   │
│ ┌─────────┐ │  │  ☑ Title (completed)             │   │
│ │ feature │ │  │  [tag3]                          │   │
│ │ (5)     │ │  │  创建: 2025-12-03               │   │
│ │ bug (3) │ │  └──────────────────────────────────┘   │
│ └─────────┘ │                                           │
│             │  [加载更多...]                           │
│ 排序        │                                           │
│ ┌─────────┐ │                                           │
│ │创建时间▼│ │                                           │
│ └─────────┘ │                                           │
└─────────────┴───────────────────────────────────────────┘
```

### 6.2 组件设计

#### 6.2.1 核心组件列表

1. **App.tsx**
   - 应用主入口
   - 路由配置（可选）
   - 全局状态管理

2. **TicketList.tsx**
   - 显示 Ticket 列表
   - 处理分页/无限滚动
   - 响应过滤和搜索

3. **TicketCard.tsx**
   - 单个 Ticket 卡片
   - 显示 Ticket 信息
   - 快速操作（完成、删除）

4. **TicketForm.tsx**
   - 创建/编辑 Ticket 表单
   - 表单验证
   - 标签选择

5. **TicketDetail.tsx**
   - Ticket 详情视图（可选）
   - 完整信息展示
   - 编辑功能

6. **TagList.tsx**
   - 标签列表/标签云
   - 显示标签和数量
   - 点击过滤

7. **TagBadge.tsx**
   - 标签徽章组件
   - 颜色显示
   - 可移除功能

8. **SearchBar.tsx**
   - 搜索输入框
   - 实时搜索
   - 清除功能

9. **FilterPanel.tsx**
   - 侧边栏过滤面板
   - 状态过滤
   - 标签过滤
   - 排序选项

10. **ConfirmDialog.tsx**
    - 确认对话框
    - 用于删除等危险操作

### 6.3 状态管理

建议使用 React Context 或轻量级状态管理方案（如 Zustand）。

#### 6.3.1 全局状态结构

```typescript
interface AppState {
  // Tickets
  tickets: Ticket[];
  currentTicket: Ticket | null;
  ticketsLoading: boolean;
  ticketsError: string | null;

  // Tags
  tags: Tag[];
  tagsLoading: boolean;

  // Filters
  filters: {
    status: 'all' | 'pending' | 'completed';
    selectedTags: number[];
    tagFilterMode: 'and' | 'or';
    searchQuery: string;
    sortBy: 'created_at' | 'updated_at' | 'title';
    sortOrder: 'asc' | 'desc';
  };

  // Pagination
  pagination: {
    page: number;
    pageSize: number;
    total: number;
  };
}
```

### 6.4 数据模型（TypeScript 接口）

```typescript
// models/ticket.ts
export interface Ticket {
  id: number;
  title: string;
  description: string | null;
  status: 'pending' | 'completed';
  tags: Tag[];
  created_at: string;
  updated_at: string;
}

export interface CreateTicketDto {
  title: string;
  description?: string;
  tag_ids?: number[];
}

export interface UpdateTicketDto {
  title?: string;
  description?: string;
}

export interface UpdateTicketStatusDto {
  status: 'pending' | 'completed';
}

// models/tag.ts
export interface Tag {
  id: number;
  name: string;
  created_at?: string;
  ticket_count?: number;
}

export interface CreateTagDto {
  name: string;
}

export interface AddTagToTicketDto {
  tag_id?: number;
  tag_name?: string;
}

// models/api.ts
export interface PaginatedResponse<T> {
  data: T[];
  total: number;
  page: number;
  page_size: number;
  total_pages: number;
}

export interface ApiError {
  detail: string;
}
```

### 6.5 API 客户端

```typescript
// api/client.ts
import axios from 'axios';

const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8000/api/v1';

export const apiClient = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// api/tickets.ts
export const ticketApi = {
  getAll: (params?: GetTicketsParams) =>
    apiClient.get<PaginatedResponse<Ticket>>('/tickets', { params }),

  getById: (id: number) =>
    apiClient.get<Ticket>(`/tickets/${id}`),

  create: (data: CreateTicketDto) =>
    apiClient.post<Ticket>('/tickets', data),

  update: (id: number, data: UpdateTicketDto) =>
    apiClient.put<Ticket>(`/tickets/${id}`, data),

  updateStatus: (id: number, data: UpdateTicketStatusDto) =>
    apiClient.patch<Ticket>(`/tickets/${id}/status`, data),

  delete: (id: number) =>
    apiClient.delete(`/tickets/${id}`),

  addTag: (ticketId: number, data: AddTagToTicketDto) =>
    apiClient.post<Ticket>(`/tickets/${ticketId}/tags`, data),

  removeTag: (ticketId: number, tagId: number) =>
    apiClient.delete<Ticket>(`/tickets/${ticketId}/tags/${tagId}`),
};

// api/tags.ts
export const tagApi = {
  getAll: (includeCount = true) =>
    apiClient.get<{ data: Tag[], total: number }>('/tags', {
      params: { include_count: includeCount }
    }),

  create: (data: CreateTagDto) =>
    apiClient.post<Tag>('/tags', data),

  delete: (id: number) =>
    apiClient.delete(`/tags/${id}`),
};
```

### 6.6 UI/UX 设计要点

#### 6.6.1 响应式设计
- 移动端：单列布局，侧边栏折叠为抽屉
- 平板：两列布局
- 桌面：三列布局（侧边栏 + 主内容）

#### 6.6.2 交互设计
- 使用 Shadcn UI 组件保证一致性
- 加载状态：骨架屏或加载指示器
- 错误提示：Toast 通知
- 成功反馈：简短的成功消息
- 平滑动画：页面切换和元素变化

#### 6.6.3 可访问性
- 键盘导航支持
- ARIA 标签
- 合适的颜色对比度
- 焦点指示器

#### 6.6.4 性能优化
- 虚拟滚动（大量 Ticket 时）
- 防抖搜索输入
- 乐观更新（立即反馈用户操作）
- 图片懒加载（如果有）

---

## 7. 实现计划

### 7.1 Phase 1: 基础架构搭建（Week 1）

#### 7.1.1 后端初始化
- [ ] 创建 FastAPI 项目结构
- [ ] 配置 PostgreSQL 连接
- [ ] 设置 SQLAlchemy ORM
- [ ] 创建数据库迁移工具配置（Alembic）
- [ ] 实现基础配置管理（环境变量）

#### 7.1.2 数据库设置
- [ ] 创建数据库表结构
- [ ] 创建索引和约束
- [ ] 实现触发器（updated_at 自动更新）
- [ ] 准备测试数据种子

#### 7.1.3 前端初始化
- [ ] 使用 Vite 创建 TypeScript 项目
- [ ] 配置 Tailwind CSS
- [ ] 安装和配置 Shadcn UI
- [ ] 设置项目目录结构
- [ ] 配置环境变量

### 7.2 Phase 2: 核心功能开发（Week 2-3）

#### 7.2.1 后端 API 开发
- [ ] 实现 Ticket CRUD endpoints
- [ ] 实现 Tag CRUD endpoints
- [ ] 实现 Ticket-Tag 关联 endpoints
- [ ] 实现查询过滤和搜索功能
- [ ] 实现分页功能
- [ ] 添加数据验证（Pydantic models）
- [ ] 实现错误处理

#### 7.2.2 前端核心组件
- [ ] 实现 API 客户端
- [ ] 创建 TypeScript 类型定义
- [ ] 实现状态管理
- [ ] 开发 TicketList 组件
- [ ] 开发 TicketCard 组件
- [ ] 开发 TicketForm 组件
- [ ] 开发 TagList 组件
- [ ] 开发 FilterPanel 组件

### 7.3 Phase 3: 高级功能和优化（Week 4）

#### 7.3.1 高级功能
- [ ] 实现实时搜索
- [ ] 实现多标签过滤
- [ ] 实现排序功能
- [ ] 添加确认对话框
- [ ] 实现 Toast 通知
- [ ] 添加加载状态

#### 7.3.2 UI/UX 优化
- [ ] 实现响应式布局
- [ ] 添加动画效果
- [ ] 优化移动端体验
- [ ] 实现键盘快捷键
- [ ] 改进可访问性

#### 7.3.3 性能优化
- [ ] 后端查询优化
- [ ] 前端防抖和节流
- [ ] 实现乐观更新
- [ ] 添加缓存策略

### 7.4 Phase 4: 测试和部署（Week 5）

#### 7.4.1 测试
- [ ] 编写后端单元测试
- [ ] 编写后端集成测试
- [ ] 编写前端组件测试
- [ ] 进行端到端测试
- [ ] 性能测试

#### 7.4.2 文档
- [ ] 编写 API 文档
- [ ] 编写部署文档
- [ ] 编写用户手册
- [ ] 代码注释完善

#### 7.4.3 部署
- [ ] 配置生产环境
- [ ] 设置 CI/CD 流程
- [ ] 部署数据库
- [ ] 部署后端服务
- [ ] 部署前端应用
- [ ] 配置域名和 HTTPS

---

## 8. 开发规范

### 8.1 代码规范

#### 8.1.1 后端（Python/FastAPI）
- 遵循 PEP 8 代码风格
- 使用类型提示（Type Hints）
  - 所有函数参数和返回值都应添加类型注解
  - 使用 mypy 进行静态类型检查
  - mypy 与 Pydantic 模型完美配合，提供端到端的类型安全
- 函数和类添加文档字符串（Docstrings）
- 使用 Black 进行代码格式化
- 使用 mypy 进行类型检查
- 使用 Ruff/Pylint 进行代码风格和质量检查

#### 8.1.2 前端（TypeScript/React）
- 遵循 ESLint 规则
- 使用 TypeScript 严格模式
- 组件使用函数式组件和 Hooks
- 使用 Prettier 进行代码格式化
- 遵循 React 最佳实践

### 8.2 Git 工作流

- 使用功能分支开发
- 提交信息遵循约定式提交（Conventional Commits）
- 代码审查后合并
- 保持主分支稳定

### 8.3 API 版本管理

- URL 中包含版本号（/api/v1）
- 向后兼容的更改不增加版本号
- 破坏性更改发布新版本

---

## 9. 未来扩展建议

### 9.1 功能扩展
- 用户认证和授权系统
- 多用户协作功能
- Ticket 优先级设置
- Ticket 到期日期和提醒
- Ticket 评论功能
- 文件附件支持
- 活动日志和历史记录
- 导出功能（CSV, PDF）
- 批量操作（批量完成、删除、添加标签）

### 9.2 技术扩展
- WebSocket 实时更新
- 全文搜索（PostgreSQL 全文搜索或 Elasticsearch）
- 缓存层（Redis）
- 消息队列（Celery）
- 移动应用（React Native）
- 数据分析和报表
- API 限流和安全加固

---

## 10. 附录

### 10.1 技术栈版本建议

#### 10.1.1 后端技术栈
- **Python**: 3.14.1 (发布于 2025-12-02)
  - 最低要求: 3.13+
- **FastAPI**: 0.123.0 (发布于 2025-12-02)
- **SQLAlchemy**: 2.0.44 (发布于 2025-10-10)
- **Pydantic**: 2.12.5 (发布于 2025-11-26)
- **Uvicorn**: 0.38.0 (发布于 2025-10-18)
- **Alembic**: 1.17.2 (发布于 2025-11-14)
- **asyncpg**: latest (异步 PostgreSQL 驱动，推荐)
- **psycopg2-binary**: latest (同步 PostgreSQL 驱动，备选)
- **mypy**: 1.19.0 (发布于 2025-11-28) - 静态类型检查器
- **PostgreSQL**: 18.1 (发布于 2025-11-13)
  - 推荐使用 PostgreSQL 17+ 或 18+

#### 10.1.2 前端技术栈
- **Node.js**: 24.x LTS "Krypton" (推荐生产环境)
  - 或 25.2.1 (Current, 最新特性)
  - 最低要求: 22+
- **TypeScript**: 5.9.3 (发布于 2025-08-01)
- **React**: 19.2.1 (发布于 2025-12-03)
- **Vite**: 7.2.6 (发布于 2025-12)
  - 要求 Node.js 20.19+, 22.12+
- **Tailwind CSS**: 4.1.17 (发布于 2025-12)
- **Shadcn UI**: latest
- **Axios**: latest
- **TanStack Query** (React Query): latest

#### 10.1.3 开发工具
- **包管理器 (Python)**: [uv](https://github.com/astral-sh/uv) - 极速 Python 包管理器 (Rust 编写)
  - 替代 pip、pip-tools、poetry、pyenv、virtualenv
  - 性能提升 10-100x
- **包管理器 (前端)**: yarn - 快速、可靠的 JavaScript 依赖管理
- **代码格式化**: Black (Python), Prettier (JavaScript/TypeScript)
- **类型检查**: mypy (Python), TypeScript Compiler (tsc)
- **代码质量检查**: Ruff/Pylint (Python), ESLint (JavaScript/TypeScript)

### 10.2 开发环境设置

#### 10.2.1 后端环境

**安装 uv (推荐方式)**
```bash
# macOS/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

# Windows (PowerShell)
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"

# 或使用 pip 安装
pip install uv
```

**初始化项目**
```bash
# 创建新项目
uv init project-alpha-backend
cd project-alpha-backend

# 或在已有目录初始化
uv init

# uv 会自动创建 pyproject.toml 文件
```

**安装 Python 和依赖**
```bash
# uv 可以自动安装和管理 Python 版本
# 安装 Python 3.14
uv python install 3.14

# 添加项目依赖（生产环境）
uv add fastapi uvicorn sqlalchemy asyncpg alembic pydantic python-dotenv

# 添加开发依赖
uv add --dev pytest pytest-asyncio black ruff mypy

# uv 会自动创建虚拟环境并安装依赖
```

**运行开发服务器**
```bash
# 使用 uv run 执行命令（自动激活虚拟环境）
uv run uvicorn main:app --reload --host 0.0.0.0 --port 8000

# 或手动激活虚拟环境
source .venv/bin/activate  # macOS/Linux
# .venv\Scripts\activate  # Windows

# 然后直接运行
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

**其他常用命令**
```bash
# 同步依赖（安装 pyproject.toml 中的所有依赖）
uv sync

# 更新依赖
uv lock --upgrade

# 运行脚本
uv run python script.py

# 查看已安装的包
uv pip list

# 运行类型检查
uv run mypy .

# 运行代码格式化
uv run black .

# 运行代码质量检查
uv run ruff check .
```

**类型检查配置（mypy）**

在 `pyproject.toml` 中添加 mypy 配置：

```toml
[tool.mypy]
python_version = "3.14"
strict = true
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
plugins = ["pydantic.mypy"]

[tool.pydantic-mypy]
init_forbid_extra = true
init_typed = true
warn_required_dynamic_aliases = true
```

**关键配置说明**：
- `strict = true`: 启用所有严格检查（推荐）
- `plugins = ["pydantic.mypy"]`: Pydantic 插件，提供更好的 Pydantic 模型类型支持
- mypy 与 FastAPI 和 Pydantic 完美配合，提供端到端的类型安全

**参考文档**：
- [mypy 官方文档](https://mypy.readthedocs.io/en/stable/)
- [Pydantic mypy 插件](https://docs.pydantic.dev/latest/integrations/mypy/)
- [FastAPI 类型提示最佳实践](https://fastapi.tiangolo.com/python-types/)

**异步数据库配置（SQLAlchemy + asyncpg）**

使用异步数据库连接可以充分发挥 FastAPI 的异步特性，提高性能。

在 `pyproject.toml` 中添加其他工具配置：

```toml
[tool.black]
line-length = 88
target-version = ['py314']

[tool.ruff]
line-length = 88
target-version = "py314"

[tool.pytest.ini_options]
asyncio_mode = "auto"
testpaths = ["tests"]
```

**SQLAlchemy 异步引擎配置示例**：

```python
# database.py
from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession, async_sessionmaker
from sqlalchemy.orm import DeclarativeBase

DATABASE_URL = "postgresql+asyncpg://postgres:postgres@localhost:5432/project_alpha"

# 创建异步引擎
engine = create_async_engine(
    DATABASE_URL,
    echo=True,  # 开发环境启用 SQL 日志
    pool_size=5,
    max_overflow=10,
)

# 创建异步 session maker
AsyncSessionLocal = async_sessionmaker(
    engine,
    class_=AsyncSession,
    expire_on_commit=False,
)

class Base(DeclarativeBase):
    pass

# 依赖注入函数
async def get_db():
    async with AsyncSessionLocal() as session:
        yield session
```

**FastAPI 路由中使用异步 session**：

```python
@app.get("/tickets")
async def get_tickets(db: AsyncSession = Depends(get_db)):
    result = await db.execute(select(Ticket))
    tickets = result.scalars().all()
    return tickets
```

**参考文档**：
- [SQLAlchemy 2.0 Async](https://docs.sqlalchemy.org/en/20/orm/extensions/asyncio.html)
- [asyncpg 文档](https://magicstack.github.io/asyncpg/)
- [FastAPI Async SQL Databases](https://fastapi.tiangolo.com/advanced/async-sql-databases/)

#### 10.2.2 前端环境

**安装 yarn (如果尚未安装)**
```bash
# 使用 npm 安装 yarn (全局)
npm install -g yarn

# 或使用 corepack (Node.js 内置)
corepack enable
corepack prepare yarn@stable --activate

# 验证安装
yarn --version
```

**创建项目**
```bash
# 使用 Vite 创建 React + TypeScript 项目
yarn create vite frontend --template react-ts

# 进入项目目录
cd frontend
```

**安装依赖**
```bash
# 安装基础依赖
yarn install

# 安装 Tailwind CSS 和相关工具
yarn add -D tailwindcss postcss autoprefixer
yarn add -D @tailwindcss/forms @tailwindcss/typography

# 初始化 Tailwind CSS
npx tailwindcss init -p

# 安装 Shadcn UI 依赖
yarn add @radix-ui/react-dialog @radix-ui/react-dropdown-menu @radix-ui/react-label
yarn add @radix-ui/react-select @radix-ui/react-separator @radix-ui/react-slot
yarn add @radix-ui/react-toast @radix-ui/react-tooltip
yarn add class-variance-authority clsx tailwind-merge lucide-react

# 安装 API 客户端和状态管理
yarn add axios @tanstack/react-query

# 安装开发工具
yarn add -D @types/node
yarn add -D eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin
yarn add -D prettier eslint-config-prettier
```

**运行开发服务器**
```bash
# 启动开发服务器
yarn dev

# 构建生产版本
yarn build

# 预览生产构建
yarn preview
```

**其他常用命令**
```bash
# 添加依赖
yarn add package-name

# 添加开发依赖
yarn add -D package-name

# 移除依赖
yarn remove package-name

# 更新所有依赖
yarn upgrade

# 运行自定义脚本
yarn run script-name

# 清理缓存
yarn cache clean

# 类型检查（不编译）
yarn tsc --noEmit

# ESLint 检查
yarn eslint . --ext .ts,.tsx

# 格式化代码
yarn prettier --write "src/**/*.{ts,tsx}"
```

**前端配置要点**

**tsconfig.json 关键配置**：

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* 类型检查 */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noImplicitAny": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",

    /* Path mapping */
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

**ESLint 和 Prettier 配置建议**：
- 使用 `eslint-config-prettier` 避免与 Prettier 冲突
- 启用 `@typescript-eslint/recommended` 规则
- React Hooks 规则：`eslint-plugin-react-hooks`

**参考文档**：
- [TypeScript tsconfig.json](https://www.typescriptlang.org/tsconfig)
- [Vite + TypeScript 配置](https://vitejs.dev/guide/features.html#typescript)
- [ESLint TypeScript](https://typescript-eslint.io/)
- [Prettier 配置](https://prettier.io/docs/en/configuration.html)

#### 10.2.3 数据库设置

**本地安装 PostgreSQL 18**

macOS:
```bash
# 使用 Homebrew 安装
brew install postgresql@18

# 启动 PostgreSQL 服务
brew services start postgresql@18

# 验证安装
psql --version
```

Ubuntu/Debian:
```bash
# 添加 PostgreSQL APT 仓库
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
sudo apt-get update

# 安装 PostgreSQL 18
sudo apt-get install postgresql-18

# 启动服务
sudo systemctl start postgresql
sudo systemctl enable postgresql

# 验证安装
psql --version
```

Windows:
```
1. 从 https://www.postgresql.org/download/windows/ 下载安装程序
2. 运行安装程序，按照向导完成安装
3. 记住设置的 postgres 用户密码
4. 确保勾选 "PostgreSQL Server" 和 "pgAdmin 4"
5. 安装完成后，PostgreSQL 服务会自动启动
```

**创建项目数据库**

安装完成后，创建项目所需的数据库：

macOS/Linux:
```bash
# 切换到 postgres 用户（如果需要）
sudo -u postgres psql

# 或者直接使用当前用户（macOS Homebrew 安装默认）
psql postgres

# 在 psql 中执行
CREATE DATABASE project_alpha;

# 创建用户（如果需要自定义用户）
# CREATE USER your_user WITH PASSWORD 'your_password';
# GRANT ALL PRIVILEGES ON DATABASE project_alpha TO your_user;

# 退出
\q
```

Windows:
```bash
# 使用 pgAdmin 4 图形界面：
# 1. 打开 pgAdmin 4
# 2. 连接到 PostgreSQL 服务器
# 3. 右键 "Databases" -> "Create" -> "Database"
# 4. 输入数据库名: project_alpha
# 5. 点击 "Save"

# 或使用命令行（在 PowerShell 或 CMD 中）：
psql -U postgres
# 输入密码后，在 psql 中执行：
CREATE DATABASE project_alpha;
\q
```

**连接数据库**
```bash
# 使用 psql 客户端连接项目数据库
psql -h localhost -p 5432 -U postgres -d project_alpha

# 常用 psql 命令
# \l          - 列出所有数据库
# \dt         - 列出所有表
# \d 表名     - 查看表结构
# \du         - 列出所有用户
# \q          - 退出
```

**验证数据库服务状态**

macOS:
```bash
# 检查服务状态
brew services list | grep postgresql

# 如果服务未运行，启动服务
brew services start postgresql@18
```

Linux:
```bash
# 检查服务状态
sudo systemctl status postgresql

# 如果服务未运行，启动服务
sudo systemctl start postgresql
```

Windows:
```bash
# 检查服务状态（在 PowerShell 中）
Get-Service -Name postgresql*

# 或在服务管理器中查看
# 按 Win+R，输入 services.msc，查找 postgresql 服务
```

### 10.3 环境变量配置

#### 10.3.1 后端 (.env)
```env
# Database (异步连接 - 推荐)
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/project_alpha

# 注意：此处使用的是开发环境示例密码
# ⚠️ 生产环境必须使用强密码！建议：
# - 最少 16 个字符
# - 包含大小写字母、数字和特殊字符
# - 使用密码管理器生成随机密码
# - 定期轮换密码

# API
API_V1_PREFIX=/api/v1
PROJECT_NAME=Project Alpha

# CORS (开发环境配置)
# 生产环境请仅允许可信域名
BACKEND_CORS_ORIGINS=["http://localhost:5173", "http://localhost:3000"]

# Development
DEBUG=True
```

**安全提醒**：
- ⚠️ 此配置文件不应提交到版本控制系统
- 添加 `.env` 到 `.gitignore` 文件
- 使用环境变量或密钥管理服务（如 AWS Secrets Manager, HashiCorp Vault）存储敏感信息

**参考资源**：
- [OWASP Database Security](https://cheatsheetseries.owasp.org/cheatsheets/Database_Security_Cheat_Sheet.html)
- [12-Factor App: Config](https://12factor.net/config)

#### 10.3.2 前端 (.env)
```env
VITE_API_BASE_URL=http://localhost:8000/api/v1
```

---

## 文档变更历史

| 版本 | 日期 | 变更说明 |
|------|------|---------|
| v1.0 | 2025-12-04 | 初始版本 |
| v1.1 | 2025-12-04 | 更新所有技术栈至最新版本；Python 包管理改用 uv；前端包管理改用 yarn |
| v1.2 | 2025-12-04 | 添加 mypy 类型检查器（v1.19.0）；修复 ticket_tags 表字段类型错误（INTEGER→BIGINT）；添加异步数据库配置（asyncpg + SQLAlchemy async）；补充 pyproject.toml 和 tsconfig.json 关键配置；添加安全警告和生产环境建议 |

---

**文档结束**
