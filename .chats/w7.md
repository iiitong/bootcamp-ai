# Instructions

## Generate PRD from wireframe

根据 @specs/w7/genslide.jpg 的内容，仔细阅读并思考，生成一个 ./specs/w7/0001-prd.md 的 PRD。要求：使用中文。这个 app 是一个本地运行的单页 app，使用 nano banana pro 生成图片 slides，可以以走马灯的形式全屏播出。后端使用 Python，前端使用 Typescript。

## PRD modifications

specs/w7/0001-prd.md 需要修改：

1. 对于侧边栏 slide，选中并拖拽可以改变顺序
2. 文本内容变化后，如果图片中没有对应文本hash的图片，在主图片区域下放一个按钮，用户点击可以生成新的图片
3. outline.yml 中需要保存用户选择的风格图片。当第一次打开时，如果没有风格图片，需要有个 popup，用户可以输入一段文字，生成两个图片，让用户选择，用户选中的作为 slides 的风格，以后生成新的图片时参考这张图片

outline 里的 style 包含：prompt 和 image，不要仅保存 style_image

## Generate design spec

根据 ./specs/w7/0001-prd.md 和 @specs/w7/genslide.jpg 的内容，生成一个 design spec，放在 ./specs/w7/0002-design-spec.md 文件中。要求：使用中文，注意所有前端所需的 API 接口要定义清楚。整体项目的目录结构也要定义清楚，后端代码层次清晰，API/业务/存储要保持清晰的边界。

## Google AI SDK usage

google ai SDK 使用：<https://ai.google.dev/gemini-api/docs/image-generation，其中核心代码：>

```python
from google import genai
from google.genai import types
from PIL import Image
client = genai.Client()
prompt = ("Create a picture of a nano banana dish in a fancy restaurant with a Gemini theme")
response = client.models.generate_content(
    model="gemini-3-pro-image-preview",
    contents=[prompt],
    config=types.GenerateContentConfig(
        image_config=types.ImageConfig(
            aspect_ratio="16:9",
            image_size="2K",
        )
    )
)
for part in response.parts:
    if part.text is not None:
        print(part.text)
    elif part.inline_data is not None:
        image = part.as_image()
        image.save("generated_image.png")
```

这里 nano banana pro 的模型名：gemini-3-pro-image-preview，更新 design spec

## Project setup

注意项目使用 uv 所有的 dep 管理和命令都使用 uv。另外，请确保所有的 dep 都是最新版本

## Generate project structure

根据 ./specs/w7/0002-design-spec.md 的内容，生成项目的空的目录结构。先不要生成代码。在 backend/ 和 frontend/ 目录下分别生成 CLAUDE.md 文件，内容考虑：

- 所使用语言框架的 best practices
- 架构设计遵循的原则：SOLID/YAGNI/KISS/DRY
- 代码的组织结构
- 并发处理
- 错误处理和日志处理

另外，分别为 backend/ 和 frontend/ 添加 gitignore 文件

claude.md 补充：
- best practice 相关的部分
- 增加 code style 部分

## Implement backend and frontend

根据 @specs/w7/0002-design-spec.md 的内容，启动 python 和 typescript 两个 agent 分别撰写后端和前端的代码。代码在 ./w7/gen-slide 下。

## 修复问题

现在生成 slide 图片错误会失败。修复改问题，并进行完善的测试。

有图片的情况下，点击 generate，生成新的图片。缩略图显示的一样，并且不能切换图片。这时候在点击其他的 slide，images 也会变多，并提示 Content has changed. Generate a new image to match。

请仔细阅读前后端代码，确保他们 API 的实现符合 ./specs/w7/0002-design-spec.md，确保
- 如果是 design spec 里缺失的 API，请在 design spec 里添加，并确保前后端一致。
- 进行完善的单元测试，确保所有功能没有问题，都符合设计。

think ultra hard

你可以使用 playwright 进行前端测试，并确保现在所有功能都符合设计要求。

现在还有一个问题，新生成的 slides 都完全包含了风格图片的一部分内容，而不只是确保风格一样，你看一下生成图片的逻辑/promt 是否有问题。think ultra hard
